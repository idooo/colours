(function(t){"use strict";var e=function(e,i){var s=this;this.popup_class="ido_colour_popup",this.element_class="ido_colour_picker",this.disabled_class="disabled",this.$element=t(e),this.$popup=void 0,this.$color=void 0,this.$caption=void 0,this.$input=void 0,this.isOpen=!1,this.caption=i.caption||this.$element.text(),this.name=i.name||this.$element.data("name")||this.$element.attr("id")||"color_picker",this.palette=this._parsePalette(i.palette||this.$element.data("palette")||"black, white"),this.color=i.color||this.$element.data("color")||this.palette[0],this.disabled=this.$element.attr("disabled")||!1,i.disabled!==void 0&&(this.disabled=i.disabled),this.palette_row_count=i.palette_row_count||this.$element.data("palette-row-count")||5,this.palette_size=i.palette_size||this.$element.data("palette-size")||42,this.onSelectColor=i.onSelectColor||function(){},this.onChangeColor=i.onChangeColor||function(){},this.onPaletteOver=i.onPaletteOver||function(){},this.onPaletteOut=i.onPaletteOut||function(){},this.init(),t(document).mouseup(function(t){var e=s.$popup;e.is(t.target)||0!==e.has(t.target).length||e.hide(),setTimeout(function(){e.is(":hidden")&&(s.isOpen=!1)},200)})};e.prototype={constructor:e,init:function(){var e=this;return this.$caption=t("<div/>").addClass("rcp_caption").text(this.caption),this.$element.addClass(this.element_class).text(""),this.$color=t("<div/>").addClass("rcp_color").css("background-color",this.color),this.$input=t("<input/>").attr("type","hidden").attr("name",this.name).val(this.color),this.$element.append([this.$caption,this.$color,this.$input]),this.$popup=e._createPopup(),e._resizePopup(),this._bindPaletteCallbacks(),this.$element.on("click",function(){e.changePopupPosition(),e.isOpen?e.close():e.disabled||e.open()}),this.disabled&&this.disable(),this},refresh:function(t){return this.$color.css("background-color",this.color),this.$input.val(this.color),this.$input.attr("name",this.name),this.$caption.text(this.caption),this.disabled?this.disable():this.enable(),t&&(this.palette=this._parsePalette(this.palette),this.$popup.find("> div").remove(),this._createPalette(this.$popup),this._resizePopup(),this._bindPaletteCallbacks(),-1===this.palette.indexOf(this.color)&&(this.color=this.palette[0],this.refresh())),this},_rgb2hex:function(t){var e="#000000",i=function(t){return("0"+parseInt(t,16).toString(16)).slice(-2)};t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);try{e="#"+i(t[1])+i(t[2])+i(t[3])}catch(s){}return e},_parsePalette:function(e){if(Array.isArray(e))return e;for(var i=e.split(","),s=0;i.length>s;s++)i[s]=t.trim(i[s]);return i},_bindPaletteCallbacks:function(){var e=this,i=this.$popup.find("> div");t.each(i,function(i,s){var o=t(s);o.unbind("mouseover").on("mouseover",function(){return e.onPaletteOver(e._rgb2hex(o.css("background-color")),this,e)}),o.unbind("mouseout").on("mouseout",function(){return e.onPaletteOut(e._rgb2hex(o.css("background-color")),this,e)})})},_createPalette:function(e){for(var i=this,s=0;i.palette.length>s;s++){var o=t("<div/>").css({"background-color":i.palette[s],width:i.palette_size,height:i.palette_size});o.on("click",function(e){var s=t(this).css("background-color"),o=i.$color.css("background-color");i.$color.css("background-color",s),i.$input.val(i._rgb2hex(s)),i.close(),i.onSelectColor(i._rgb2hex(s),this,i),o!==s&&i.onChangeColor(i._rgb2hex(s),this,i),e.stopPropagation(),e.preventDefault()}),e.append(o)}return this},_resizePopup:function(){var e=t(this.$popup.find(">:first-child")[0]),i=e.outerWidth(!0)*this.palette_row_count+1;return this.$popup.css("max-width",i),this},_createPopup:function(){var e=t("<div/>").addClass(this.popup_class).hide();return this._createPalette(e),e.insertBefore(this.$element),e},changePopupPosition:function(){return this.$popup.css("margin-top",this.$element.outerHeight()+2),this},open:function(){return this.$popup.show(),this.isOpen=!0,this},close:function(){return this.$popup.hide(),this.isOpen=!1,this},disable:function(){this.disabled=!0,this.$element.addClass(this.disabled_class)},enable:function(){this.disabled=!1,this.$element.removeClass(this.disabled_class)}},t.fn.idoColours=function(i,s){return this.each(function(){var o=t(this),n=o.data("idoColours"),a="object"==typeof i&&i;if(n||o.data("idoColours",n=new e(this,t.extend({},a))),"string"==typeof i){var r=!1,l=["palette","onPaletteOver","onPaletteOut","palette_size","palette_row_count"];l.indexOf(i)>-1&&(r=!0),n[i]=s,n.refresh(r)}})},t('[data-provide="ido-colours"]').idoColours()})(window.jQuery);