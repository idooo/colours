(function(t){"use strict";var e=function(e,i){var o=this;this.popup_class="ido_colour_popup",this.element_class="ido_colour_picker btn",this.$element=t(e),this.$popup=void 0,this.$color=void 0,this.$caption=void 0,this.$input=void 0,this.isOpen=!1,this.caption=i.caption||this.$element.text(),this.name=i.name||this.$element.data("name")||"color",this.palette=this._parsePalette(i.palette||this.$element.data("palette")||"black, white"),this.color=i.color||this.$element.data("color")||this.palette[0],this.palette_row_count=i.palette_row_count||this.$element.data("palette-row-count")||5,this.palette_size=i.palette_size||this.$element.data("palette-size")||42,this.onSelectColor=i.onSelectColor||function(){},this.onChangeColor=i.onChangeColor||function(){},this.onPaletteOver=i.onPaletteOver||function(){},this.onPaletteOut=i.onPaletteOut||function(){},this.init(),t(document).mouseup(function(t){var e=o.$popup;e.is(t.target)||0!==e.has(t.target).length||e.hide(),setTimeout(function(){e.is(":hidden")&&(o.isOpen=!1)},200)})};e.prototype={constructor:e,init:function(){var e=this;return this.$caption=t("<div/>").addClass("rcp_caption").text(this.caption),this.$element.addClass(this.element_class).text(""),this.$color=t("<div/>").addClass("rcp_color").css("background-color",this.color),this.$input=t("<input/>").attr("type","hidden").attr("name",this.name).val(this.color),this.$element.append([this.$caption,this.$color,this.$input]),this.$popup=e._createPopup(),e._resizePopup(),this._bindPaletteCallbacks(),this.$element.on("click",function(){e.changePopupPosition(),e.isOpen?e.close():e.open()}),this},refresh:function(t){return this.$color.css("background-color",this.color),this.$input.val(this.color),this.$input.attr("name",this.name),this.$caption.text(this.caption),t&&(this.palette=this._parsePalette(this.palette),this.$popup.find("> div").remove(),this._createPalette(this.$popup),this._resizePopup(),this._bindPaletteCallbacks(),-1===this.palette.indexOf(this.color)&&(this.color=this.palette[0],this.refresh())),this},_rgb2hex:function(t){var e="#000000",i=function(t){return("0"+parseInt(t,16).toString(16)).slice(-2)};t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);try{e="#"+i(t[1])+i(t[2])+i(t[3])}catch(o){}return e},_parsePalette:function(e){if(Array.isArray(e))return e;for(var i=e.split(","),o=0;i.length>o;o++)i[o]=t.trim(i[o]);return i},_bindPaletteCallbacks:function(){var e=this,i=this.$popup.find("> div");t.each(i,function(i,o){var s=t(o);s.unbind("mouseover").on("mouseover",function(){return e.onPaletteOver(e._rgb2hex(s.css("background-color")),this,e)}),s.unbind("mouseout").on("mouseout",function(){return e.onPaletteOut(e._rgb2hex(s.css("background-color")),this,e)})})},_createPalette:function(e){for(var i=this,o=0;i.palette.length>o;o++){var s=t("<div/>").css({"background-color":i.palette[o],width:i.palette_size,height:i.palette_size});s.on("click",function(e){var o=t(this).css("background-color"),s=i.$color.css("background-color");i.$color.css("background-color",o),i.$input.val(i._rgb2hex(o)),i.close(),i.onSelectColor(i._rgb2hex(o),this,i),s!==o&&i.onChangeColor(i._rgb2hex(o),this,i),e.stopPropagation(),e.preventDefault()}),e.append(s)}return this},_resizePopup:function(){var e=t(this.$popup.find(">:first-child")[0]),i=e.outerWidth(!0)*this.palette_row_count+1;return this.$popup.css("max-width",i),this},_createPopup:function(){var e=t("<div/>").addClass(this.popup_class).hide();return this._createPalette(e),e.insertBefore(this.$element),e},changePopupPosition:function(){return this.$popup.css("margin-top",this.$element.outerHeight()+2),this},open:function(){return this.$popup.show(),this.isOpen=!0,this},close:function(){return this.$popup.hide(),this.isOpen=!1,this}},t.fn.idoColours=function(i,o){return this.each(function(){var s=t(this),n=s.data("idoColours"),r="object"==typeof i&&i;if(n||s.data("idoColours",n=new e(this,t.extend({},r))),"string"==typeof i){var a=!1,h=["palette","onPaletteOver","onPaletteOut","palette_size","palette_row_count"];h.indexOf(i)>-1&&(a=!0),n[i]=o,n.refresh(a)}})},t('[data-provide="ido-colours"]').idoColours()})(window.jQuery);