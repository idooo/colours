(function(t){"use strict";var o=function(o,e){var i=this;this.popup_class="ido_colour_popup",this.element_class="ido_colour_picker btn",this.$element=t(o),this.$popup=void 0,this.$color=void 0,this.$caption=void 0,this.$input=void 0,this.isOpen=!1,this.caption=e.caption||this.$element.text(),this.name=e.name||this.$element.data("name")||"color",this.palette=this._parsePalette(e.palette||this.$element.data("palette")||"black, white"),this.color=e.color||this.$element.data("color")||this.palette[0],this.onSelectColor=e.onSelectColor||function(){},this.onChangeColor=e.onChangeColor||function(){},this.onPaletteClick=e.onPaletteClick||function(){},this.onPaletteOver=e.onPaletteOver||function(){},this.onPaletteOut=e.onPaletteOut||function(){},this.init(),t(document).mouseup(function(t){var o=i.$popup;o.is(t.target)||0!==o.has(t.target).length||o.hide(),setTimeout(function(){o.is(":hidden")&&(i.isOpen=!1)},200)})};o.prototype={constructor:o,init:function(){var o=this;return this.$caption=t("<div/>").addClass("rcp_caption").text(this.caption),this.$element.addClass(this.element_class).text(""),this.$color=t("<div/>").addClass("rcp_color").css("background-color",this.color),this.$input=t("<input/>").attr("type","hidden").attr("name",this.name).val(this.color),this.$element.append([this.$caption,this.$color,this.$input]),this.$popup=o.createPopup(),this._bindCallbacks(),this.$element.on("click",function(){o.changePopupPosition(),o.isOpen?o.closePopup():o.openPopup()}),this},refresh:function(){this.$color.css("background-color",this.color),this.$input.val(this.color),this.$input.attr("name",this.name),this.$caption.text(this.caption),this.palette=this._parsePalette(this.palette)},_rgb2hex:function(t){var o="#000000",e=function(t){return("0"+parseInt(t,16).toString(16)).slice(-2)};t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);try{o="#"+e(t[1])+e(t[2])+e(t[3])}catch(i){}return o},_parsePalette:function(o){if(Array.isArray(o))return o;for(var e=o.split(","),i=0;e.length>i;i++)e[i]=t.trim(e[i]);return e},_bindCallbacks:function(){var t=this.$popup.find("> div");t.on("click",this.onPaletteClick),t.on("mouseover",this.onPaletteOver),t.on("mouseout",this.onPaletteOut)},createPopup:function(){for(var o=t("<div/>").addClass(this.popup_class).hide(),e=this,i=0;e.palette.length>i;i++){var n=t("<div/>").css("background-color",e.palette[i]);n.on("click",function(o){var i=t(this).css("background-color"),n=e.$color.css("background-color");e.$color.css("background-color",i),e.$input.val(e._rgb2hex(i)),e.closePopup(),e.onSelectColor(e,this,e._rgb2hex(i)),n!==i&&e.onChangeColor(e,this,e._rgb2hex(i)),o.stopPropagation(),o.preventDefault()}),o.append(n)}return o.insertBefore(e.$element),o},changePopupPosition:function(){return this.$popup.css("margin-top",this.$element.outerHeight()+2),this},openPopup:function(){return this.$popup.show(),this.isOpen=!0,this},closePopup:function(){return this.$popup.hide(),this.isOpen=!1,this},bind:function(t,o){var e=this,i=e.$popup.find("> div");return"paletteclick"===t?i.on("click",o):"paletteover"===t?i.on("mouseover",o):"paletteout"===t?i.on("mouseout",o):"select"===t?this.onSelectColor=o:"change"===t&&(this.onChangeColor=o),this}},t.fn.idoColours=function(e,i){return this.each(function(){var n=t(this),s=n.data("idoColours"),r="object"==typeof e&&e;s||n.data("idoColours",s=new o(this,t.extend({},r))),"string"==typeof e&&(s[e]=i,s.refresh())})},t('[data-provide="ido-colours"]').idoColours()})(window.jQuery);