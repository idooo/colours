(function(t){"use strict";var o=function(o){var i=this;this.popup_class="ido_colour_popup",this.element_class="ido_colour_picker btn",this.$element=t(o),this.$popup=void 0,this.$input=void 0,this.isOpen=!1,this.caption=this.$element.text(),this.color=this.$element.data("color")||"white",this.name=this.$element.data("name")||"color",this.palette=this.$element.data("palette")||"black, white",this.onSelectColor=void 0,this.onChangeColor=void 0,this.init(),t(document).mouseup(function(t){var o=i.$popup;o.is(t.target)||0!==o.has(t.target).length||o.hide(),setTimeout(function(){o.is(":hidden")&&(i.isOpen=!1)},200)})};o.prototype={constructor:o,init:function(){var o=this,i=t("<div/>").addClass("rcp_caption").text(this.caption);return this.$element.addClass(this.element_class).text(""),this.$color=t("<div/>").addClass("rcp_color").css("background-color",this.color),this.$input=t("<input/>").attr("type","hidden").attr("name",this.name).val(this.color),this.$element.append([i,this.$color,this.$input]),this.$popup=o.createPopup(),this.$element.on("click",function(){o.changePopupPosition(),o.isOpen?o.closePopup():o.openPopup()}),this},_rgb2hex:function(t){var o="#000000",i=function(t){return("0"+parseInt(t,16).toString(16)).slice(-2)};t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);try{o="#"+i(t[1])+i(t[2])+i(t[3])}catch(e){}return o},_callback:function(t){return this[t]!==void 0?this[t]():!1},createPopup:function(){for(var o=t("<div/>").addClass(this.popup_class).hide(),i=this.palette.split(","),e=this,n=0;i.length>n;n++){var s=t("<div/>").css("background-color",t.trim(i[n]));s.on("click",function(o){var i=t(this).css("background-color"),n=e.$color.css("background-color");e.$color.css("background-color",i),e.$input.val(e._rgb2hex(i)),e.closePopup(),e._callback("onSelectColor"),n!==i&&e._callback("onChangeColor"),o.stopPropagation(),o.preventDefault()}),o.append(s)}return o.insertBefore(e.$element),o},changePopupPosition:function(){return this.$popup.css("margin-top",this.$element.outerHeight()+2),this},openPopup:function(){return this.$popup.show(),this.isOpen=!0,this},closePopup:function(){return this.$popup.hide(),this.isOpen=!1,this},bind:function(t,o){var i=this,e=i.$popup.find("> div");return"paletteclick"===t?e.on("click",o):"paletteover"===t?e.on("mouseover",o):"paletteout"===t?e.on("mouseout",o):"select"===t?this.onSelectColor=o:"change"===t&&(this.onChangeColor=o),this}},t.fn.idoColours=function(){var i=this.each(function(){var i=t(this),e=i.data("idoColours");e||i.data("idoColours",new o(this))});return i}})(window.jQuery);