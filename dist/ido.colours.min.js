(function(t){"use strict";var e=function(e,o){var i=this;this.popup_class="ido_colour_popup",this.element_class="ido_colour_picker btn",this.$element=t(e),this.$popup=void 0,this.$color=void 0,this.$caption=void 0,this.$input=void 0,this.isOpen=!1,this.caption=o.caption||this.$element.text(),this.name=o.name||this.$element.data("name")||"color",this.palette=this._parsePalette(o.palette||this.$element.data("palette")||"black, white"),this.color=o.color||this.$element.data("color")||this.palette[0],this.onSelectColor=o.onSelectColor||function(){},this.onChangeColor=o.onChangeColor||function(){},this.onPaletteOver=o.onPaletteOver||function(){},this.onPaletteOut=o.onPaletteOut||function(){},this.init(),t(document).mouseup(function(t){var e=i.$popup;e.is(t.target)||0!==e.has(t.target).length||e.hide(),setTimeout(function(){e.is(":hidden")&&(i.isOpen=!1)},200)})};e.prototype={constructor:e,init:function(){var e=this;return this.$caption=t("<div/>").addClass("rcp_caption").text(this.caption),this.$element.addClass(this.element_class).text(""),this.$color=t("<div/>").addClass("rcp_color").css("background-color",this.color),this.$input=t("<input/>").attr("type","hidden").attr("name",this.name).val(this.color),this.$element.append([this.$caption,this.$color,this.$input]),this.$popup=e._createPopup(),this._bindPaletteCallbacks(),this.$element.on("click",function(){e.changePopupPosition(),e.isOpen?e.close():e.open()}),this},refresh:function(t){return this.$color.css("background-color",this.color),this.$input.val(this.color),this.$input.attr("name",this.name),this.$caption.text(this.caption),t&&(this.palette=this._parsePalette(this.palette),this.$popup.find("> div").remove(),this._createPalette(this.$popup),this._bindPaletteCallbacks(),-1===this.palette.indexOf(this.color)&&(this.color=this.palette[0],this.refresh())),this},_rgb2hex:function(t){var e="#000000",o=function(t){return("0"+parseInt(t,16).toString(16)).slice(-2)};t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);try{e="#"+o(t[1])+o(t[2])+o(t[3])}catch(i){}return e},_parsePalette:function(e){if(Array.isArray(e))return e;for(var o=e.split(","),i=0;o.length>i;i++)o[i]=t.trim(o[i]);return o},_bindPaletteCallbacks:function(){var e=this,o=this.$popup.find("> div");t.each(o,function(o,i){var n=t(i);n.unbind("mouseover").on("mouseover",function(){return e.onPaletteOver(e._rgb2hex(n.css("background-color")),this,e)}),n.unbind("mouseout").on("mouseout",function(){return e.onPaletteOut(e._rgb2hex(n.css("background-color")),this,e)})})},_createPalette:function(e){for(var o=this,i=0;o.palette.length>i;i++){var n=t("<div/>").css("background-color",o.palette[i]);n.on("click",function(e){var i=t(this).css("background-color"),n=o.$color.css("background-color");o.$color.css("background-color",i),o.$input.val(o._rgb2hex(i)),o.close(),o.onSelectColor(o._rgb2hex(i),this,o),n!==i&&o.onChangeColor(o._rgb2hex(i),this,o),e.stopPropagation(),e.preventDefault()}),e.append(n)}return this},_createPopup:function(){var e=t("<div/>").addClass(this.popup_class).hide();return this._createPalette(e),e.insertBefore(this.$element),e},changePopupPosition:function(){return this.$popup.css("margin-top",this.$element.outerHeight()+2),this},open:function(){return this.$popup.show(),this.isOpen=!0,this},close:function(){return this.$popup.hide(),this.isOpen=!1,this}},t.fn.idoColours=function(o,i){return this.each(function(){var n=t(this),s=n.data("idoColours"),r="object"==typeof o&&o;if(s||n.data("idoColours",s=new e(this,t.extend({},r))),"string"==typeof o){var a=!1,c=["palette","onPaletteOver","onPaletteOut"];c.indexOf(o)>-1&&(a=!0),s[o]=i,s.refresh(a)}})},t('[data-provide="ido-colours"]').idoColours()})(window.jQuery);